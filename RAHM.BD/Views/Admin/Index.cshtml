@model dynamic
@{
    Layout = "~/Views/Shared/_Layout.Dashboard.cshtml";
    ViewData["Title"] = "Admin Dashboard";
}

<style>
    .dashboard-container {
        padding: 20px;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        text-align: center;
        transition: transform 0.3s ease;
    }

        .stat-card:hover {
            transform: translateY(-5px);
        }

    .stat-number {
        font-size: 2.5rem;
        font-weight: bold;
        margin: 10px 0;
    }

    .stat-title {
        color: #666;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .alert-card {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
    }

    .success-card {
        background: #d4edda;
        border-color: #c3e6cb;
    }

    .danger-card {
        background: #f8d7da;
        border-color: #f5c6cb;
    }

    .info-card {
        background: #d1ecf1;
        border-color: #bee5eb;
    }

    .primary-card {
        background: #cce5ff;
        border-color: #99d1ff;
    }

    .secondary-card {
        background: #e2e3e5;
        border-color: #d6d8db;
    }

    .activity-item {
        background: white;
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 10px;
        border-left: 4px solid #007bff;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .chart-container {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
    }

    .badge-custom {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 500;
    }
</style>

<div class="dashboard-container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>📊 Admin Dashboard</h1>
        <small class="text-muted">Last updated: @DateTime.Now.ToString("yyyy-MM-dd HH:mm")</small>
    </div>

    <!-- Key Statistics -->
    <div class="stats-grid">
        <div class="stat-card primary-card">
            <div class="stat-title">Total Users</div>
            <div class="stat-number" style="color: #007bff;">@Model.TotalUsers</div>
            <small><i class="fas fa-users"></i> Registered Users</small>
        </div>
        <div class="stat-card success-card">
            <div class="stat-title">Total Vaccinations</div>
            <div class="stat-number" style="color: #28a745;">@Model.TotalVaccinations</div>
            <small><i class="fas fa-syringe"></i> Doses Administered</small>
        </div>
        <div class="stat-card info-card">
            <div class="stat-title">Available Vaccines</div>
            <div class="stat-number" style="color: #17a2b8;">@Model.TotalVaccines</div>
            <small><i class="fas fa-vial"></i> Vaccine Types</small>
        </div>
        <div class="stat-card secondary-card">
            <div class="stat-title">Health Centers</div>
            <div class="stat-number" style="color: #6c757d;">@Model.TotalHealthCenters</div>
            <small><i class="fas fa-hospital"></i> Active Centers</small>
        </div>
        <div class="stat-card alert-card">
            <div class="stat-title">Today's Vaccinations</div>
            <div class="stat-number" style="color: #856404;">@Model.TodayVaccinations</div>
            <small><i class="fas fa-calendar-day"></i> Administered Today</small>
        </div>
        <div class="stat-card danger-card">
            <div class="stat-title">Stock Alerts</div>
            <div class="stat-number" style="color: #dc3545;">@Model.OutOfStockCount</div>
            <small><i class="fas fa-exclamation-triangle"></i> Out of Stock</small>
        </div>
    </div>

    <div class="row">
        <!-- Recent Activity -->
        <div class="col-md-6">
            <div class="chart-container">
                <h4><i class="fas fa-clock"></i> Recent Vaccinations</h4>
                <div style="max-height: 400px; overflow-y: auto;">
                    @if (Model.RecentVaccinations.Count > 0)
                    {
                        foreach (var vaccination in Model.RecentVaccinations)
                        {
                            <div class="activity-item">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <strong>@vaccination.UserName</strong>
                                        <br>
                                        <span class="badge-custom success-card">@vaccination.VaccineName</span>
                                        <small class="text-muted">for @vaccination.DiseaseName</small>
                                    </div>
                                    <div class="text-end">
                                        <small class="text-muted">@vaccination.CenterName</small>
                                        <br>
                                        <small>@vaccination.VaccinatedAt.ToString("MM/dd HH:mm")</small>
                                    </div>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <p class="text-muted text-center">No recent vaccinations</p>
                    }
                </div>
            </div>
        </div>

        <!-- Stock Alerts -->
        <div class="col-md-6">
            <div class="chart-container">
                <h4><i class="fas fa-exclamation-triangle text-warning"></i> Low Stock Alerts</h4>
                <div style="max-height: 400px; overflow-y: auto;">
                    @if (Model.LowStockAlerts.Count > 0)
                    {
                        foreach (var alert in Model.LowStockAlerts)
                        {
                            <div class="alert alert-warning mb-2">
                                <strong>@alert.VaccineName</strong> at <em>@alert.CenterName</em>
                                <br>
                                <small>Only <span class="badge bg-warning">@alert.QuantityAvailable</span> doses left</small>
                                <small class="text-muted">(@alert.DiseaseName)</small>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i> All vaccines are well-stocked!
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Performance Metrics -->
    <div class="row">
        <!-- Top Vaccines -->
        <div class="col-md-6">
            <div class="chart-container">
                <h4><i class="fas fa-trophy text-warning"></i> Most Used Vaccines</h4>
                @if (Model.TopVaccines.Count > 0)
                {
                    foreach (var vaccine in Model.TopVaccines)
                    {
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <div>
                                <strong>@vaccine.VaccineName</strong>
                                <br>
                                <small class="text-muted">@vaccine.DiseaseName</small>
                            </div>
                            <span class="badge bg-primary">@vaccine.TimesUsed administered</span>
                        </div>
                    }
                }
                else
                {
                    <p class="text-muted text-center">No vaccination data available</p>
                }
            </div>
        </div>

        <!-- Regional Distribution -->
        <div class="col-md-6">
            <div class="chart-container">
                <h4><i class="fas fa-map-marker-alt text-info"></i> Vaccinations by Region</h4>
                @if (Model.VaccinationsByRegion.Count > 0)
                {
                    foreach (var region in Model.VaccinationsByRegion)
                    {
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span><i class="fas fa-map-pin"></i> @region.Division</span>
                            <span class="badge bg-info">@region.VaccinationCount vaccines</span>
                        </div>
                    }
                }
                else
                {
                    <p class="text-muted text-center">No regional data available</p>
                }
            </div>
        </div>
    </div>

    <!-- Weekly Trend -->
    <div class="row">
        <div class="col-12">
            <div class="chart-container">
                <h4><i class="fas fa-chart-line text-success"></i> Daily Vaccination Trend (Last 7 Days)</h4>
                <div class="row">
                    @if (Model.DailyVaccinations.Count > 0)
                    {
                        foreach (var day in Model.DailyVaccinations)
                        {
                            <div class="col-md-1 text-center mb-2">
                                <div class="badge-custom info-card p-2">
                                    <div><strong>@day.DailyCount</strong></div>
                                    <small>@day.VaccinationDate.ToString("MM/dd")</small>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="col-12">
                            <p class="text-muted text-center">No recent vaccination data</p>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="chart-container">
                <h4><i class="fas fa-tools"></i> Quick Actions</h4>
                <div class="row">
                    <div class="col-md-3 mb-2">
                        <a href="/Admin/VaccinationLogs" class="btn btn-outline-primary btn-block w-100">
                            <i class="fas fa-list"></i> View All Vaccinations
                        </a>
                    </div>
                    <div class="col-md-3 mb-2">
                        <a href="/Admin/VaccineManagement" class="btn btn-outline-success btn-block w-100">
                            <i class="fas fa-vial"></i> Manage Vaccines
                        </a>
                    </div>
                    <div class="col-md-3 mb-2">
                        <a href="/Admin/UserManagement" class="btn btn-outline-info btn-block w-100">
                            <i class="fas fa-users"></i> Manage Users
                        </a>
                    </div>
                    <div class="col-md-3 mb-2">
                        <a href="/Admin/Reports" class="btn btn-outline-warning btn-block w-100">
                            <i class="fas fa-chart-bar"></i> Generate Reports
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Auto-refresh dashboard every 5 minutes
    setTimeout(function() {
        location.reload();
    }, 300000);

    // Add click tracking for quick actions
    document.querySelectorAll('.btn-outline-primary, .btn-outline-success, .btn-outline-info, .btn-outline-warning').forEach(btn => {
        btn.addEventListener('click', function() {
            console.log('Quick action clicked:', this.textContent.trim());
        });
    });
</script>
